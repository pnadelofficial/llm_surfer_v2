research_goal = """
The goal of this research is to develop a comprehensive inventory of federal climate adaptation policies in the United States. We define climate adaptation policies as policies that support “adjustments in ecological, social, or economic systems in response to actual or expected climatic stimuli and their effects or impacts.
### Grounds for inclusion:
* Action constitutes a policy instrument (can include plans or strategies). Policy instruments, or tools, are “the techniques through which governments generate, evaluate, and implement policy options” (Kapano and Howlett, 2020)
* Action constitutes adaptation based on the three categories listed below
* We include policies that would not be implemented for any other reason than to adapt to climate change (we call these policies “Explicit Adaptation Policies”). An example of an Explicit Adaptation policy is a National Adaptation Strategy designed to respond to climate change.
* We also include policies that would not be implemented for any other reason other than to address climate-related hazards (such as flood, heat, or drought), but do not directly mention climate change or adaptation (we call these “Explicit Hazard Policies”). For example, though a policy on decreasing flood risk may not mention climate change, it still increases resilience to a climate hazard (flooding) so would be included.
* We also include policies that may be implemented for multiple reasons not exclusive to climate adaptation, but that have an impact on climate resilience (we call these “Implicit Policies”). An example of this is a social services policy like funding affordable housing after a disaster.
### Grounds for exclusion:
* Policies focused exclusively on climate change mitigation
* Aspirational policy statements with no clear policy instrument
* Non-adaptation risk reduction:
    - Environmental or disaster preparedness policies that did not significantly relate to the effects of climate change were excluded. This includes environmental management of toxics and earthquake policies for example.
    - Actions taking place solely at the local or state government level, with no federal involvement
### Hazard Type::
Determine what hazard type it discusses. If the policy focuses on a single environmental hazard, classify that policy by this hazard.
* Flood: a temporary overflow of water onto land that is normally dry.
* Sea-Level Rise/Coastal Erosion: average increase in the water level of the Earth’s oceans. Includes coastal inundation, saline intrusion.
* Storms: More frequent and/or intense thunderstorms, wind storms, tropical storms, high winds, and storm surges.
* Wildfire: an unplanned, unwanted fire burning in a natural area, such as a forest, grassland, or prairie.
* Heat: A prolonged period of excessively hot weather, with temperatures above the average high.
* Drought: A deficiency of precipitation over an extended period of time (usually a season or more), resulting in a water shortage.
* Non-Hazard Specific: Policy does not directly address climatic hazard.
* Multi-Hazard: Policy addresses multiple climatic hazards.
If the policy mentions multiple environmental hazards, classify the policy as "multi-hazard".
### Hazard Classification - Explicit Adaptation:
Determine whether or not it represent an explicit adaptation policy according to the following definition:
* Explicit Adaptation: Policies with a primary stated goal to adapt to climate change. Climate adaptation or resilience is mentioned in the text.
Respond with either "Yes" or "No". Even if you have decided this document is not relevant, please supply a classification.
### Hazard Classification - Explicit Hazard:
Determine whether or not it represent an explicit hazard policy according to the following definition:
* Explicit Hazard: Policies that address climate-related hazards (such as flood, heat, or drought), but do not directly mention climate change or adaptation.
Respond with either "Yes" or "No". Even if you have decided this document is not relevant, please supply a classification.
### Hazard Classification - Implicit:
Determine whether or not it represent an implicit policy according to the following definition:
* Implicit: Policies that do not have a stated goal to address climate-related hazards or adaptation, but that have an impact on climate resilience.
Respond with either "Yes" or "No". Even if you have decided this document is not relevant, please supply a classification.
### Sector Classification:
Classify the document according to the following sector types:
* Emergency management: Includes public safety during extreme events and responses to natural hazards.
* Infrastructure: Built environment, including land use planning, housing, utilities, and public works. Excludes coastal infrastructure and transportation.
* Health: Includes public health agencies, clinical services, and medical interventions.
* Education: Includes primary, secondary, and tertiary school systems.
* Human services: Includes gender equality, immigration, families, Indigenous groups, social affairs, minority affairs, religious affairs, welfare and social services.
* Agriculture: Includes irrigation, plant/seed technology.
* Water: Water for human consumption and recreation, as well as irrigation for crops.
* Environment: Includes natural resources, public park systems, sustainability, mines, meteorology, geosciences, biodiversity, and conservation.
* Energy: Includes oil, natural gas, hydropower, and electrical grids.
* Coast management: Coastal settlements infrastructure.
* Development: Includes international cooperation, development aid, sustainable development, and rural development -- local development included.
* National Security: Military response to instability/volatility associated with climate change. May include responses to population displacement, disease transmission, Arctic sovereignty, or resource conflict.
* Forestry: Forest ecosystem health; forest ecosystems used in economic activities. Includes game management and community forests.
* Fisheries: Marine/riparian ecosystem health; marine/riparian ecosystems used in economic activities.
* Transportation: Includes road/highway maintenance, public transportation, air traffic, railroad systems, shipping. Insurance Private sector.
* Tourism: Private sector. Includes recreation. 
* Economy: Costs associated with climate change. Includes finance, employment, labour, trade, treasury, industry, and livelihoods.
* Culture: Impacts of climate change on particular sites or practices considered important to group identity and/or survival.
* Technology: Includes science, research, and innovation.
* Inter-sectoral: Multiple sections.
* Other
Even if you have decided this document is not relevant, please supply a classification.
### Primary Policy Instrument Classification:
Classify the document according to the following primary policy instruments.
* Appropriating Statute: Any statutory provision that provides budget authority, thus permitting a federal agency to incur obligations and make payments from the Treasury for specified purposes, usually during a specified period of time.
* Authorizing Statute: Any statutory provision that defines the authority of the government to act. It can establish or continue a federal agency, program, project, or activity. Further, it may establish policies and restrictions and deal with organizational and administrative matters. It may also, explicitly or implicitly, authorize subsequent congressional action to provide appropriations. By itself, however, an authorization does not provide funding for government activities.
Even if you have decided this document is not relevant, please supply a classification.
### Secondary Policy Instrument Classification:
Classify the document according to the following secondary policy instruments.
* Inter-governmental mandate: Directives requiring adaptation by other levels of government.
* Spatial planning: Rules for allocating land uses, public space design standards. Includes greening and conservation, tree planting.
* Infrastructure performance standards: Standards for infrastructure performance, including performance assessment requirement (e.g. flood risk assessment).
* Building regulations: Rules for building and construction standards.
* Strategic planning: Adoption of policy guidance documents that integrate adaptation considerations in impacted sectors (including sustainability planning).
* Adaptation planning: Adoption of policy guidance documents for adaptation (including climate or resilience plans that cover adaptation).
* User charges: Fees paid on the basis of service usage.
* Grants or subsidies: Financial transfers awarded on a conditional basis. Can include non-financial social services.
* Loans: Financial transfers given on the basis of repayment.
* Direct expenditures: Capital investments (e.g. road works, parks, tree planting); land acquisition.
* Demonstration projects: Use of government- owned facilities to demonstrate new ideas or technologies.
* Facilities: Adapting city facilities to different purposes (e.g. cooling centers)
* Exhortation: Normative arguments to persuade actors to engage in adaptation action. Including endorsements of action from other levels of government or non-state actors and feedback toother levels of government on strategic plans.
* Advice: Sharing of knowledge and experience with other agencies or departments in government or key stakeholders.
* Education and training: Formalized knowledge- sharing aimed at local government staff and/or key stakeholders.
* Reports and assessments: Change system modelling, impact and vulnerability assessments, or scenario-based planning tools.
* Monitoring and evaluation: Monitoring changes in exposure or adaptive capacity (i.e. environmental and social conditions).
* Knowledge network: Collaborative actor networks for the purpose of sharing ideas, knowledge, and experience on adaptation.
* Public outreach: General information campaigns to educate communities or stakeholders about climate change and adaptation.
* Conferences and workshops: Participation in or hosting of conferences or workshops with stakeholders outside local government.
* Agreements: Agreements between governments and/or non-government actors to common policy objectives (both governments at the same level and different levels). Including urban climate networks.
* Advisory groups creation: Creation of working groups, committees, or boundary organizations for the purpose of better understanding adaptation challenges and providing advice to government on how to act.
* Labelling: Forms of measurement intended to make individuals aware of climate change concerns and to contribute to good design or production practices and innovation.
* Research funding: Funding to non-government actors for knowledge production, including scenarios, assessments, projections.
* Interest group funding: Funding for groups that participate in or influence public policy based on a common concern.
* Hearings: Formal meeting for receiving information on public record from stakeholders on various sides of an issue.
* Institutional/program reforms: Creation of new agencies, departments, working groups, committees, personnel positions. Making reforms to existing programs or agencies.
* Judicial review: Review of executive or legislative decisions by courts.
* Other
""".strip()

base_prompt = """
You are a helpful AI assistant trained by Meta AI that is uniquely skilled at helping people with data collection and other associated research tasks. 
You will be given the text from a webpage or PDF, its title, if one exists, and its url. From this information you must decide how relevant this webpage to the research goal.
The categories of relevancy should only be one of the following: 'Not relevant', 'Somewhat relevant', 'Relevant', 'Very relevant', 'Highly relevant'.
Be careful and mindful of synonyms and words which may have multiple meanings in different context. For example, just because a document mentions "adaptation" doesn't mean it is about climate adaptation.
No matter the input, you should respond with two things 1) a determination of whether or not this input is relevant to the research goal and 2) a short comment on why you made that determination.
## Research Goal
{research_goal}
## Input website
### Title: {title}
### URL: {url}
### Text: {text}
## Correctly formatted relevancy determination
""".strip()

json_schema = {
    "name":"relevancy_determination",
    "schema":{
        "type":"object",
        "properties":{
            "hazard_type": {"type": "string"},
            "hazard_explicit_adaptation": {"type": "string"},
            "hazard_explicit_hazard": {"type": "string"},
            "hazard_implicit": {"type": "string"},
            "sector_class": {"type": "string"},
            "primary_policy_instrument": {"type": "string"},
            "secondary_policy_instrument": {"type": "string"},
            "relevancy": {"type": "string"},
            "comment": {"type": "string"},
        },
    "strict": True
    }
}

query = """
"Climate adaptation" OR "adaptation" OR "resilience" 
""".strip()